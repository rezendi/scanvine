{% extends "main/base.html" %}
{% block title %}{{article.title}} | {{publication.name}} | Scanvine{% endblock %}
{% block startjs %}
<script>window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));</script>

<style>
#stats {
    display:flex;
    justify-content:space-around;
}
.statbox {
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:5px;
}
.statlabel {
    font-style:italic;
}
</style>

{% endblock %}
{% block main %}
<section>
    
    <div class="article-list">
        {% include "main/article-entry.html" with article=article %}
    </div>

    <b>Stats</b>
    <div id="stats">
        <div class="statbox">
            <span class="statlabel">Fetched</span> <span class="statval">{{article.created_at}}</span>
        </div>
        <div class="statbox">
            <span class="statlabel">Score</span> <span class="statval">{{article.credibility}}</span>
        </div>
        <div class="statbox">
            <span class="statlabel">Author score</span> <span class="statval">{{article.author.total_cred}}</span>
        </div>
        <div class="statbox">
            <span class="statlabel">Author average</span> <span class="statval">{{article.author.average_cred}}</span>
        </div>
        <div class="statbox">
            <span class="statlabel">Publication score</span> <span class="statval">{{article.publication.total_cred}}</span>
        </div>
        <div class="statbox">
            <span class="statlabel">Publication average</span> <span class="statval">{{article.publication.average_cred}}</span>
        </div>
        <div class="statbox">
            <span class="statlabel">Shares</span>
            <span class="statval">{{article.scores.health_shares}}, {{article.scores.science_shares}}, {{article.scores.tech_shares}}, {{article.scores.business_shares}}, {{article.scores.media_shares}}</span>
        </div>
    </div>

    <p><b>Shared by</b></p>
    <div id="article-sharers">
        {% for share in shares %}
        <a title="{{share.category}}" href="https://twitter.com/{{share.sharer.twitter_screen_name}}/status/{{share.twitter_id}}">{{share.sharer.name}}</a>{% if not forloop.last%}, {% endif %}
        {% endfor %}
    </div>
    
    <p><b>Tweets</b></p>
    {% for share in shares %}
        <div id="tweet-container-{{share.twitter_id}}"/>
    {% endfor %}
</section>
{% endblock %}

{% block endjs %}
<script>
setTimeout(function(){
{% for share in shares %}
twttr.widgets.createTweet(
  '{{share.twitter_id}}',
  document.getElementById('tweet-container-{{share.twitter_id}}'),
);
{% endfor %}
}, 1000);
</script>
{% endblock %}